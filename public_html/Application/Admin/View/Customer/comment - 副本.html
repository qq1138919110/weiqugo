<include file="public:header"/>
<link href="__CSS__page.css" rel="stylesheet" type="text/css" />

<!-- Header ends -->

<!-- Main content starts -->


    <!-- Sidebar ends -->

  	<!-- Main bar -->
  	<div class="mainbar">

      <!-- Page heading -->
      <div class="page-head">
        <h2 class="pull-left">饭堂评论</h2>
        <div class="clearfix"></div>
      </div>
      <!-- Page heading ends -->


	    <!-- Matter -->

	    <div class="matter">
        <div class="container">
          <div class="row">
            <div class="col-md-12">

              <div class="widget">
            
                <div class="widget-content medias">

              <div class="form-group">
                 <button type="button" class="btn btn-danger batch_delete_comment">批量删除评论</button>
              </div>
                  <table class="table table-striped table-bordered table-hover">
                      <thead>
                        <tr>
                         <th>
                            <span class="uni">
                              <input type='checkbox'  id="checkall"/>
                            </span>
                          </th>
                          <th>用户昵称</th>
                          <th style="width:300px;">评论内容</th>
                          <th>评论的时间</th>
                          <th>评论打分</th>
                          <th>是否显示</th>
                          <th>是否回复</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody>
                      <volist name="list" id="list">
                        <tr>
                         <td>                            
                            <span class="uni">
                              <input type='checkbox'  value="{$list.comment_id}" name="comment_id[]"/>
                            </span>
                          </td>
                        <?php
                        $users =$listuser[$list['comment_id']];
                        ?>
                          <td>{$users.name}</td>
                          <td>{$list.comments}</td>
                          <td>{:date('Y-m-d H:i:s',$list['comment_time'])}</td>
                          <td>{$list.comment_rate}</td>
                          <td><if condition="$list['is_examination'] eq 0">不显示<else />显示</if></td>
                          <td><if condition="$list['is_answer'] eq 0">末回复<else />已回复</if></td>
                          <td>
                            <a href="{:U('Customer/reply_comment',array('comment_id'=>$list['comment_id']))}"><button type="button" class="btn btn-success">回复</button></a>
                            <a href="{:U('Customer/comment_examination',array('comment_id'=>$list['comment_id']))}"><button type="button" class="btn btn-primary">审核</button></a>
                             <button type="button" class="btn btn-danger deletecomment">删除评论</button>
                             <input type="hidden" value="{$list['comment_id']}">
                          </td>
                        </tr>
                      </volist>


                      </tbody>
                    </table>

                    <div class="widget-foot">


                      
                        <ul class="pagination pull-right">
                          <div class="sabrosus">{$page}</div>
                        </ul>
                      
                      <div class="clearfix"></div> 

                    </div>

                </div>
              </div>  
              
            </div>
          </div>
        </div>
		  </div>

		<!-- Matter ends -->

    </div>

   <!-- Mainbar ends -->	    	
   <div class="clearfix"></div>

</div>
<script src="__JS__jquery-2.1.1.min.js"></script>
<script type="text/javascript">
  $(function(){
    $(document).on('click','.deletecomment',function(){
      var comment_id =$(this).next('input').val();
      if(comment_id==''){
        location =location;
      }
      $.ajax({
        type:"POST",
        url:"{:U('Customer/delete_comment')}",
        data:{comment_id:comment_id},
        dataType:'json',
        success:function(data){
          if(data==1){
            alert('非法操作');
            location =location;
          }else if(data==2){
            location=location;
          }else if(data==3){
            alert('服务器延迟，请刷新后再试');
            location=location;
          }
        }
      })
    });
    $("#checkall").click(function(){
          if($("#checkall").is(":checked")== true){
              $('input[name="comment_id[]"]').each(function(){
                this.checked = true;
              });
          }else{
              $('input[name="comment_id[]"]').each(function(){
                this.checked = false;
              });
          }
          });
    $(document).on('click','.batch_delete_comment',function(){
       var obj=document.getElementsByName('comment_id[]'); //选择所有name="'test'"的对象，返回数组
              //取到对象数组后，我们来循环检测它是不是被选中
              var s='';
              for(var i=0; i<obj.length; i++){
              if(obj[i].checked) s+=obj[i].value+','; //如果选中，将value添加到变量s中
              }
              if(s==''){
              alert('你还没有选择任何内容！');
              return false;
              }
              $.ajax({
                type:"GET",
                url:"{:U('Customer/batch_delete_comment')}",
                data:{comment_id:s},
                dataType:'json',
                success:function(data){
                  if(data==1){
                window.location=location;
               }else{
                alert('服务器延迟，请刷新后再试');
                window.location=location;
               }
                }
              })
    });
  });


</script>
<!-- Content ends -->

<!-- Footer starts -->
<include file="public:footer"/>