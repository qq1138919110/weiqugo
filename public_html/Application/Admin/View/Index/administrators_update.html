<include file="public:header"/>
  	<!-- Main bar -->
  	<div class="mainbar">


	    <!-- Matter -->

	    <div class="matter">
        <div class="container">

          <div class="row">

            <div class="col-md-12">


              <div class="widget wgreen">
                
                <div class="widget-head">
                  
                  <div class="clearfix"></div>
                </div>

                <div class="widget-content">
                  <div class="padd">

                  
                    <!-- Form starts.  -->
                     <form class="form-horizontal" role="form">
                              
                             <div class="form-group row">
                               <label class="col-lg-1 control-label">旧密码</label>
                               <div class="col-lg-4">
                                  <input type="password" class="form-control" name="oldpassword" id="oldpassword">
                               </div>
                            </div>

                            <div class="form-group row">
                               <label class="col-lg-1 control-label">密码</label>
                               <div class="col-lg-4">
                                  <input type="password" class="form-control" name="password" id="password">
                               </div>
                            </div>

                            <div class="form-group row">
                               <label class="col-lg-1 control-label">确定密码</label>
                               <div class="col-lg-4">
                                  <input type="password" class="form-control" name="rpassword" id="rpassword">
                               </div>
                            </div>

                            <div class="form-group row">
                               <label class="col-lg-1 control-label">手机号码</label>
                               <div class="col-lg-4">
                                  <input type="text" class="form-control" name="phone" id="phone" value="{$user.phone}">
                               </div>
                            </div>

                            <div class="form-group">
                                  <div class="col-lg-offset-1 col-lg-9">
                                    <input type="hidden" class="uid" value="{$user.id}">
                                    <button type="button" class="btn btn-primary baobaocuncun">保存</button>
                                  </div>
                                </div>

                </form>
                  </div>
                </div>
                  <div class="widget-foot">
                    <!-- Footer goes here -->
                  </div>
              </div>  

            </div>

          </div>

        </div>
		  </div>

		<!-- Matter ends -->

    </div>

   <!-- Mainbar ends -->	    	
   <div class="clearfix"></div>

</div>
<script src="__JS__jquery-2.1.1.min.js"></script>
<script type="text/javascript">
  $(function(){
   $(document).on('click','.baobaocuncun',function(){
    var uid =$('.uid').val();
    if(uid==''){
      location =location;
    }
    var oldpassword =$('#oldpassword').val();
    if(oldpassword==''){
      alert('旧密码不能为空');
      return false;
    }
    var password =$('#password').val();
    if(password==''){
      alert('管理员密码不能为空');
      return false;
    }
    var rpassword =$('#rpassword').val();
    if(password!=rpassword){
      alert('两次密码不一致');
      return false;
    }
    var phone =$('#phone').val();
         if(phone.match(/^(?:13|15|18|17|14)[0-9]{9}$/)===null){
          alert('手机号码不正确');
          return false;
         }
     $.ajax({
      type:"POST",
      url:"{:U('Index/administrators_update')}",
      data:{uid:uid,oldpassword:oldpassword,password:password,phone:phone},
      dataType:'json',
      success:function(data){
        if(data==1){
          location=location;
        }else if(data==2){
          alert('管理员手机号码已存在');
          return false;
        }else if(data==3){
          alert('密码错误');
          return false;
        }else if(data==4){
          window.location.href="{:U('Index/administrators')}";
        }else if(data==5){
          alert('服务器延迟，请刷新后再试');
          location=location;
        }
      }
     })
   });
  });
</script>
<include file="public:footer"/>