<include file="public:header"/>

    <!-- Sidebar ends -->

    <!-- Main bar -->
    <div class="mainbar">
      
      <!-- Page heading -->
      <div class="page-head">
        <!-- Page heading -->
        <h2 class="pull-left"> 
          <!-- page meta -->
          <span class="page-meta">下单客户</span>
        </h2>


        <!-- Breadcrumb -->
        <div class="bread-crumb pull-right"></div>

        <div class="clearfix"></div>

      </div>
      <!-- Page heading ends -->



      <!-- Matter -->

      <div class="matter">
        <div class="container">

          <div class="row">

            <div class="col-md-12">


              <div class="widget wgreen">
                
                <div class="widget-head">
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a> 
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>

                <div class="widget-content">
                  <div class="padd">

                    <!-- Form starts.  -->
                    <form action="{:U('Index/users_export')}" method="post" class="form-horizontal" role="form"id="form1111">
                    

                          <div class="form-group">
                          <label class="col-lg-4 control-label">顾客ID</label>
                          <div class="col-lg-2">
                            <input type="text" class="form-control user_id" >
                          </div>
                        </div>

                          <div class="form-group">
                          <label class="col-lg-4 control-label">顾客电话</label>
                          <div class="col-lg-2">
                            <input type="text" class="form-control phone" >
                          </div>
                        </div>


                       

                      <div class="form-group">
                        <div style="margin-left:30px;" class="col-lg-9">
                          <button type="button" class="btn btn-primary search">搜索</button>
                          <button type="submit" class="btn btn-success derived">导出生成excel</button>
                          <button type="button" class="btn btn-default chongzhizhi">重置</button>
                        </div>
                      </div>

                <div class="form-group xianxianxianshi">
                   <table class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                          <th>
                            <span class="uni">
                              <input type='checkbox'  id="checkall"/>
                            </span>
                          </th>
                          <th>顾客id</th>
                          <th>姓名</th>
                          <th>顾客电话</th>
                          <th>待处理订单总数</th>
                          <th>进行中订单总数</th>
                          <th>成功订单总数</th>
                          <th>失败订单总数</th>
                          <th>总成功金额</th>
                        </tr>
                      </thead>
                      <tbody  class="dddddd">
                        <volist name="user" id="user">
                        <tr>
                          <td>                            
                            <span class="uni">
                              <input type='checkbox'  value="{$user.id}" name="id[]"/>
                            </span>
                          </td>
                          <td>{$user.id}</td>
                          <td>{$user.name}</td>
                          <td>{$user.phone}</td>
                          <?php
                          $count11 =$count1[$user['id']];
                          $count22 =$count2[$user['id']];
                          $count33 =$count3[$user['id']];
                          $count44 =$count4[$user['id']];
                          $money =$moneycount[$user['id']];
                          ?>
                          <td><if condition="$count11 eq ''">0<else />{$count11}</if></td>
                          <td><if condition="$count22 eq ''">0<else />{$count22}</if></td>
                          <td><if condition="$count33 eq ''">0<else />{$count33}</if></td>
                          <td><if condition="$count44 eq ''">0<else />{$count44}</if></td>
                          <td><if condition="$money eq ''">0<else />{$money}</if></td>
                        </tr>
                        </volist>
                      </tbody>
                    </table>
                  </div>
                  </form>

                  </div>
                </div>
                  <div class="widget-foot">
                    <!-- Footer goes here -->
                  </div>
              </div>  

            </div>

          </div>

        </div>
      </div>

    <!-- Matter ends -->

    </div>

   <!-- Mainbar ends -->
   <div class="clearfix"></div>
   <script src="__JS__jquery-2.1.1.min.js"></script>
     <script type="text/javascript">
$(function(){
  $(document).on('click','.chongzhizhi',function(){
   $("input").val(""); 
});
  $(document).on('click','.search',function(){
   
    var user_id =$('.user_id').val();
    var phone =$('.phone').val();
    $.ajax({
      type:"GET",
      url:"{:U('Index/single_customer')}",
      data:{user_id:user_id,phone:phone},
      dataType:'json',
      success:function(data){
        var list =data.user;
        var dd ='';
        for(var i=0 in list){
          dd +='<tr>';
          dd +='<td>';                          
          dd +='<span class="uni">';
          dd +=' <input type="checkbox"  value="'+list[i].id+'" name="id[]"/>';                   
          dd +='</span>';                
          dd +='</td>';
          dd +='<td>'+list[i].id+'</td>';
          dd +='<td>'+list[i].name+'</td>';
          dd +='<td>'+list[i].phone+'</td>';
           var count11 =data.count1[list[i].id];
           var count22 =data.count2[list[i].id];
           var count33 =data.count3[list[i].id];
           var count44 =data.count4[list[i].id];
           var money =data.moneycount[list[i].id];
          if(count11!=null){
            dd +='<td>'+count11+'</td>';
          }else{
            dd +='<td>0</td>';
          }
          if(count22!=null){
            dd +='<td>'+count22+'</td>';
          }else{
            dd +='<td>0</td>';
          }
          if(count33!=null){
            dd +='<td>'+count33+'</td>';
          }else{
            dd +='<td>0</td>';
          }
          if(count44!=null){
            dd +='<td>'+count44+'</td>';
          }else{
            dd +='<td>0</td>';
          }
          if(money!=null){
            dd +='<td>'+money+'</td>';
          }else{
            dd +='<td>0</td>';
          }                
          dd +='</tr>';            
        }
        $('.xianxianxianshi').show();
       $('.dddddd').html(dd);
      }
    })
  });
      function getLocalTime(time){
  time =time- 8*3600;
  var d=new Date(time*1000);
  var day=d.getUTCDate();
  var month =d.getUTCMonth() + 1;
  var year =d.getUTCFullYear();
  return year + "-" + month + "-" +day;
 }
  $("#checkall").click(function(){
          if($("#checkall").is(":checked")== true){
              $('input[name="id[]"]').each(function(){
                this.checked = true;
              });
          }else{
              $('input[name="id[]"]').each(function(){
                this.checked = false;
              });
          }
          });
            $(document).on('click','.derived',function(){
                var obj=document.getElementsByName('id[]'); //选择所有name="'test'"的对象，返回数组
              //取到对象数组后，我们来循环检测它是不是被选中
              var s='';
              for(var i=0; i<obj.length; i++){
              if(obj[i].checked) s+=obj[i].value+','; //如果选中，将value添加到变量s中
              }
              if(s==''){
              alert('你还没有选择任何内容！');
              return false;
              }

          
          });
      });
</script>
</div>
<include file="public:footer"/>
