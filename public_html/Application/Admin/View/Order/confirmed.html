<include file="public:header"/>
<link href="__CSS__page.css" rel="stylesheet" type="text/css" />

    <!-- Sidebar ends -->

    <!-- Main bar -->
    <link rel="stylesheet" type="text/css" href="__CSS__timepicki.css"/>
    <style type ="text/css">
    .timetime{padding:8px 5px;width:200px;border-radius:3px;border:1px solid #ddd;outline:none;text-align:center;color:#666;box-shadow: 2px 2px 5px 0px rgba(50, 50, 50, 0.35);}
.timetime:focus{border-color:#ccc;color:#333;}
</style>
    
    <div class="mainbar">
      
      <!-- Page heading -->
      <div class="page-head">
        <!-- Page heading -->
         <h2 class="pull-left">
          <!-- page meta -->
          <span class="page-meta">已发货订单管理</span>
        </h2>


        <!-- Breadcrumb -->
        <div class="bread-crumb pull-right">
         
        </div>

        <div class="clearfix"></div>

      </div>
      <!-- Page heading ends -->



      <!-- Matter -->

      <div class="matter">
        <div class="container">
          <div>
         
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
              <li role="presentation" ><a href="{:U('Order/index')}">待发货订单</a></li>
              <li role="presentation" class="active"><a href="{:U('Order/confirmed')}">已发货订单</a></li>
              <li role="presentation"><a href="{:U('Order/successful')}">成功订单</a></li>
              <li role="presentation"><a href="{:U('Order/fail')}">取消订单</a></li>

            </ul>

            <!-- Tab panes -->
        <div class="tab-content">
          
            

              
                <form action="{:U('Order/goods_export')}" method="post">
                <div class="form-group">
                 <button type="button" class="btn btn-success success">成功订单</button>
                 <button type="button" class="btn btn-danger fail">取消订单</button>
                 <button type="submit" class="btn btn-primary">导出excel</button>
              </div>
                 
               <table class="table table-striped table-bordered table-hover">
                      <thead>
                        <tr>
                          <th>
                            <span class="uni">
                              <input type='checkbox'  id="checkall"/>
                            </span>
                          </th>
                          <th>下单顾客电话</th>
                          <th>订单编号</th>
                          <th>下单时间</th>
                          <th>支付时间</th>
                          <th>详情</th>
                          <th>备注</th>
                          <th>总价</th>
                          <th>收货人姓名</th>
                          <th>收货人电话</th>
                          <th>收货地址</th>
                        </tr>
                      </thead>
                      <tbody>
                        <volist name="list" id="order">
                        <tr>
                          <td>                            
                            <span class="uni">
                              <input type='checkbox'  value="{$order.order_id}" name="order_id[]"/>
                            </span>
                          </td>
                           <td>{$order.uid.user_phone}</td>
                          <td>{$order.order_no}</td>
                          <td>{:date('Y-m-d H:i:s',$order['booking_time'])}</td>
                          <td>{:date('Y-m-d H:i:s',$order['pay_time'])}</td>
                          <td>
                          <volist name="order['order_detail']" id="shop_detail">
                          <?php
                          if($shop_detail['goods_attr']){
                            echo $shop_detail['goods_name'].'('.$shop_detail['goods_attr'].')'.'x'.$shop_detail['sales_amount'].',';
                          }else{
                            echo $shop_detail['goods_name'].'x'.$shop_detail['sales_amount'].','; 
                          }
                          
                          ?>
                          </volist>
                          </td>
                          <td>{$order.c_remark}</td>
                          <td>{$order.amount}</td>
                          <td>{$order.consignee_name}</td>
                          <td>{$order.consignee_phone}</td>
                          <td>{$order.address}</td>
                        </tr>
                        </volist>
                      </tbody>
                    </table>
                    </form>
                  <div class="widget-foot">


                      
                        <ul class="pagination pull-right">
                          <div class="sabrosus">{$page}</div>
                        </ul>
                      
                      <div class="clearfix"></div> 

                    </div>
            

            
            </div>
            
            
          </div>

        </div>
      </div>

    <!-- Matter ends -->

    </div>

   <!-- Mainbar ends -->        
   <div class="clearfix"></div>

</div>
<script src="__JS__jquery-2.2.2.min.js"></script>        
<script type="text/javascript">
        $(function() {
           $("#checkall").click(function(){
          if($("#checkall").is(":checked")== true){
              $('input[name="order_id[]"]').each(function(){
                this.checked = true;
              });
          }else{
              $('input[name="order_id[]"]').each(function(){
                this.checked = false;
              });
          }
          });
           $(document).on('click','.success',function(){
              var obj=document.getElementsByName('order_id[]'); //选择所有name="'test'"的对象，返回数组
              //取到对象数组后，我们来循环检测它是不是被选中
              var s='';
              for(var i=0; i<obj.length; i++){
              if(obj[i].checked) s+=obj[i].value+','; //如果选中，将value添加到变量s中
              }
              if(s==''){
              alert('你还没有选择任何内容！');
              return false;
              }
              $.ajax({
                type:"GET",
                url:"{:U('Order/success_order')}",
                data:{order_id:s},
                dataType:'json',
                success:function(data){
                  if(data==1){
                window.location=location;
               }else{
                alert('服务器延迟，请刷新后再试');
                window.location=location;
               }
                }
              })
           });
           $(document).on('click','.fail',function(){
              var obj=document.getElementsByName('order_id[]'); //选择所有name="'test'"的对象，返回数组
              //取到对象数组后，我们来循环检测它是不是被选中
              var s='';
              for(var i=0; i<obj.length; i++){
              if(obj[i].checked) s+=obj[i].value+','; //如果选中，将value添加到变量s中
              }
              if(s==''){
              alert('你还没有选择任何内容！');
              return false;
              }
              $.ajax({
                type:"GET",
                url:"{:U('Order/fail_order')}",
                data:{order_id:s},
                dataType:'json',
                success:function(data){
                  if(data==1){
                window.location=location;
               }else{
                alert('服务器延迟，请刷新后再试');
                window.location=location;
               }
                }
              })
           });
        });
    </script>
<!-- Content ends -->

<!-- Footer starts -->
  <include file="public:footer"/>