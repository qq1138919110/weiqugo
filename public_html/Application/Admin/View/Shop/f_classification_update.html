<include file="public:header"/>

    <!-- Sidebar ends -->
     <style type ="text/css">
    .timetime{padding:8px 5px;width:200px;border-radius:3px;border:1px solid #ddd;outline:none;text-align:center;color:#666;box-shadow: 2px 2px 5px 0px rgba(50, 50, 50, 0.35);}
.timetime:focus{border-color:#ccc;color:#333;}

.demo{width:700px;margin:0 auto}
    .btn:hover{background-color: #e95a00;text-decoration: none}
    .ul_pics li{float:left;width:160px;height:160px;border:1px solid #ddd;padding:2px;text-align: center;margin:0 5px 5px 0;}
    .ul_pics li .img{width: 160px;height: 140px;display: table-cell;vertical-align: middle;}
    .ul_pics li img{max-width: 160px;max-height: 140px;vertical-align: middle;}
    .progress{position:relative;padding: 1px; border-radius:3px; margin:60px 0 0 0;} 
    .bar {background-color: green; display:block; width:0%; height:20px; border-radius:3px; } 
    .percent{position:absolute; height:20px; display:inline-block;top:3px; left:2%; color:#fff } 
    .img_close{background: transparent url('__IMG__/bg_icon.png') no-repeat scroll -25px 0px; position: absolute; width: 15px; height: 15px; right: -7px; top: -7px}
</style>
  	<!-- Main bar -->
  	<div class="mainbar">
      
	    <!-- Page heading -->
	    <div class="page-head">
        <!-- Page heading -->
	      <h2 class="pull-left"> 
          <!-- page meta -->
          <span class="page-meta">修改分类 </span>
        </h2>


        <!-- Breadcrumb -->
        <div class="bread-crumb pull-right">
         
         
        </div>

        <div class="clearfix"></div>

	    </div>
	    <!-- Page heading ends -->



	    <!-- Matter -->

	    <div class="matter">
        <div class="container">

          <div class="row">

            <div class="col-md-12">


              <div class="widget wgreen">
                
                <div class="widget-head">
                  <div class="pull-left"></div>
                  <div class="widget-icons pull-right">
                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a> 
                    <a href="#" class="wclose"><i class="icon-remove"></i></a>
                  </div>
                  <div class="clearfix"></div>
                </div>

                <div class="widget-content">
                  <div class="padd">

                   
                    <!-- Form starts.  -->
                      <form class="form-horizontal" role="form" method="post" action="{:U('Shop/f_classification_update')}">

                    

                      <div class="form-group">
                      <label class="col-lg-4 control-label">分类名称</label>
                      <div class="col-lg-2">
                      <input type="text" class="form-control namaenamename" placeholder="分类名称" name="type_name" value="{$type.type_name}">
                      </div>
                      <div class="col-lg-2" style="margin-left:-18px; margin-top:6px;">（分类名称只能为1-10个字）</div>
                      </div>
                                
                      <div class="form-group">
                      <label class="col-lg-4 control-label">分类编号</label>
                      <div class="col-lg-2">
                      <input type="text" class="form-control" placeholder="分类编号" name="type_no" value="{$type.type_no}">
                      </div>
                      <div class="col-lg-3" style="margin-left:-18px; margin-top:6px;">（决定展示顺序，编号越小越靠前）</div>
                      </div>
                      
                      <div class="form-group">
                      <label class="col-lg-4 control-label">分类链接</label>
                      <div class="col-lg-4">
                      <input type="text" class="form-control" placeholder="分类链接" name="type_link" value="{$type.type_link}">
                      </div>
                      <div class="col-lg-2" style="margin-left:-18px; margin-top:6px;">（分类名称只能为1-10个字）</div>
                      </div>

                     

                  <div class="form-group row">
                   <div class="control-group">
                     <label class="control-label">分类图</label>
                     <div class="controls demo">
                       <a class="btn" id="btn">上传图片</a> 最大2mb，支持jpg，gif，png格式。
                       <ul id="ul_pics" class="ul_pics clearfix">
                       <notempty name="type.type_images">
                       <php>$moreimg = explode(',',$type['type_images']);</php>
                       <volist name="moreimg" id="moree">
                       <li><div class='img' style='position: relative;'><img src='{$moree}'/><span class='img_close'></span><input type='hidden' name='more_img[]' value='{$moree}' /></div></li>
                       </volist>
                       </notempty>
                       </ul>
                     </div>
                    </div>
                 </div> 



                      <div class="form-group">
                      <div class="col-lg-9">
                      <input type="hidden" name="type_id" value="{$type['type_id']}">
                      <button type="submit" class="btn btn-primary">保存</button>
                      </div>
                      </div>
                      </form>
                      </div>
                      </div>
                      <div class="widget-foot">
                      <!-- Footer goes here -->
                      </div>
              </div>  

            </div>

          </div>

        </div>
		  </div>

		<!-- Matter ends -->

    </div>

   <!-- Mainbar ends -->	    	
   <div class="clearfix"></div>

</div>
<script src="__JS__jquery-2.1.1.min.js"></script>
<script type="text/javascript">
  $(function(){

$("form").submit(function(){
      var x=$('.namaenamename').val().length;
      if(x==''){
        alert('分类名称不能为空');
        return false;
      }
      if(x>10){
        alert('分类名称只能为1-10个字');
        return false;
      }
      var self = $(this);
      $.ajax({
        url:self.attr("action"),
        type:"POST",
        data:self.serialize(),
        dataType:'json',
        success:function(data){
          if(data==1){
              window.location="{:U('Shop/f_classification')}";
          }else if(data==3){
            alert('非法操作');
            window.location=location;
          }else if(data==4){
            alert('编号只能为数字');
            return false;
          }else if(data==2){
              alert('服务器延迟,请重新再试');
              window.location=location;
          }
        }
      });
      return false;
     });
  })
</script>
  <script type="text/javascript" src="__JS__plupload.full.min.js"></script>
    <script type="text/javascript">
    var category_add = "{:U('Index/get_son')}";
    var delete_more = "{:U('Index/delete_more')}";
    var upload = "__UPLOADS__";

    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    
    var uploader = new plupload.Uploader({
                //创建实例的构造方法
                runtimes: 'html5,flash,silverlight,html4', 
                //上传插件初始化选用那种方式的优先级顺序
                browse_button: 'btn', // 上传按钮
                url: "{:U('Shop/more_img')}", //远程上传地址
                flash_swf_url: '/public/Admin/js/Moxie.swf', //flash文件地址
                silverlight_xap_url: '/public/Admin/js/Moxie.xap', //silverlight文件地址
                filters: {
                    max_file_size: '2mb', //最大上传文件大小（格式100b, 10kb, 10mb, 1gb）
                    mime_types: [{title: "files", extensions: "jpg,png,gif,jpeg"}]
                    //允许文件上传类型
                },
                multi_selection: false, //true:ctrl多文件上传, false 单文件上传
                init: {
                    FilesAdded: function(up, files) { //文件上传前 
                        if ($("#ul_pics").children("li").length > 0) {
                            alert("您上传的图片太多了！");
                            // uploader.destroy();
                            return false;
                        } else {
                            var li = '';
                            plupload.each(files, function(file) { //遍历文件
                                li += "<li id='" + file['id'] + "'><div class='progress'><span class='bar'></span><span class='percent'>0%</span></div></li>";
                            });
                            $("#ul_pics").append(li);
                            uploader.start();
                        }
                    },
                    UploadProgress: function(up, file) { //上传中，显示进度条
                 var percent = file.percent;
                        $("#" + file.id).find('.bar').css({"width": percent + "%"});
                        $("#" + file.id).find(".percent").text(percent + "%");
                    },
                    FileUploaded: function(up, file, info) { //文件上传成功的时候触发
                        var data = JSON.parse(info.response);
                        $("#" + file.id).html("<div class='img' style='position: relative;'><img src='" + data.path + data.name + "'/><span class='img_close'></span><input type='hidden' name='more_img[]' value='"+ data.path + data.name +"' /></div><p>" + data.name + "</p>");
                    },
                    Error: function(up, err) { //上传出错的时候触发
                        alert(err.message);
                    }
                }
            });
            uploader.init();
</script>
<script type="text/javascript">
    $(function(){ 
$(document).on('click','.img_close',function(){
  $(this).parent().parent('li').remove();
    });
    });
</script>
<!-- Content ends -->

<!-- Footer starts -->
<include file="public:footer"/>